% PlotSetBasedSim(agentPos, obst, threshold)
%
% plots max distance to target and min distance to projectile throughout
% the simulation

function PlotSimDistance(agentPos, obst, threshold, target)

    figure()
    hold on
    
    
    % mA - coordinate (usually size 3)
    % nA - number of points in each set
    % pA - time step, equal to iterations in simulation
    [mA,nA,pA] = size(agentPos);
    
    % mO - coordinate (usually size 3)
    % nO - time step, equal to iterations in simulation
    % pO - obstacle number
    [mO,nO,pO] = size(obst);
    
    
    ObstDist = zeros(pA,pO);
    
    
    for i = 1:pO
         % mA - coordinate (usually size 3)
    % nA - time step, equal to iterations in simulation
    [mA,nA] = size(agentPos);
    
    % create objects/convex hulls for each set at each time step
        for i = 1:nA

            % format points for MakeObj function
            curSet = zeros(3,4);

            curSet(:,1) = [agentPos(1,i);agentPos(3,i);0];
            curSet(:,2) = [agentPos(1,i);agentPos(4,i);0];
            curSet(:,3) = [agentPos(2,i);agentPos(3,i);0];
            curSet(:,4) = [agentPos(2,i);agentPos(4,i);0];

            % min distance to projectile
            temp_xObst = [obst(:,j,i),obst(:,j,i)]; % polytope dist function has trouble with only one point
            polyOptions = optimoptions('fmincon','Display','notify-detailed','algorithm','active-set');
            PolytopeMinDist(curSet,temp_xObst,polyOptions)
            ObstDist(j,i) = PolytopeMinDist(curSet,temp_xObst,polyOptions);

        end
        plot(0:1:(pA-1),transpose(ObstDist(:,i)));
        plot(0:1:(pA-1),threshold*ones(1,(pA)));
    end
    
    title('Minimum distance between vehicle polytope and obstacle polytope');
    xlabel('time');
    ylabel('distance');
    
    figure()
    hold on;
    dist = zeros(pA,1);
    
    for i = 1:pA
        for j = 1:nA

            dist(i) = dist(i) + norm(agentPos(:,j,i)-target)^2;

        end
        
    end
    
    plot(0:1:(pA-1),dist);
    title('Minimum distance between vehicle polytope and target polytope');
    xlabel('time');
    ylabel('distance');
    

    
    
    
    


end